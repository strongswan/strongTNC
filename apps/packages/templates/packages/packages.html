{% extends "front/base.html" %}

{% load i18n %}
{% load permissions %}
{% load paged_block %}

{% block title %}{{ title }}{% endblock %}

{% block hero %}
    <h1>{{ title }}</h1>
{% endblock %}


{% block content %}
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span3" id="line">
                <h4>{% trans "Package" %}
                    {% if 'auth.write_access' in perms %}
                        <div class="pull-right">
                            <a class="btn btn-primary btn-mini" href="{% url 'packages:package_add' %}"
                               rel="tooltip" title="add new">
                                <i class="icon-plus-sign icon-white"></i>
                            </a>
                        </div>
                    {% endif %}
                </h4>
                <hr>
                <div class="row-fluid">
                    {% paged_block config_name="package_list_config" with_filter=True %}
                </div>
            </div>

            <div class="span9" id="content">
                {% if package %}
                    <form class="form-horizontal" method="POST" action="{% url 'packages:package_save' %}" id="packageform">
                        {% csrf_token %}
                        {% if add %}
                            <h4>{% trans 'Add new package' %}</h4>
                            <div class="control-group" id="name-group">
                                <label class="control-label" for="id">{% trans "Name" %}</label>

                                <div class="controls">
                                    <input type="hidden" id="packageId" name="packageId" value="{{ package.id }}"/>
                                    <input type="text" id="name" name="name" placeholder="{% trans 'Name' %}"
                                           rel="tooltip"
                                           title="{% trans 'Package Name' %}"
                                           value="{{ package.name }}" {% input_editability %}>
                                </div>
                            </div>
                            <hr>
                        {% else %}
                            <div class="row-fluid">
                                <h3>{% trans 'Package info:' %} {{ package.name }}</h3>
                            </div>
                        {% endif %}

                        <h4>{% trans "Versions:" %}
                            <a class="btn-small" href="#" rel="tooltip"
                               title="{% trans 'All versions of this package' %}"><i class="icon-info-sign"></i></a>
                        </h4>
                        {% if versions %}
                            <div class="row-fluid">
                                <table id="versions" class="table table-hover table-striped sortable">
                                    <thead>
                                    <tr>
                                        <th>{% trans 'Version' %}</th>
                                        <th>{% trans 'OS' %}</th>
                                        <th>{% trans 'Security' %}</th>
                                        <th class="sorter-strongTNCDate">{% trans 'Registered on' %}</th>
                                        <th class="sorter-false">{% trans 'Blacklisted' %}</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for v in versions %}
                                        <tr id="version{{ v.id }}">
                                            <td>{{ v.release }}</td>
                                            <td>{{ v.product.name }}</td>
                                            <td>{{ v.security|yesno:_("Yes,No") }}</td>
                                            <td>{{ v.time|date:'M d H:i:s Y' }}</td>
                                            <td>
                                                <button type="button" class="blacklistToggle btn btn-mini
                                                {% if v.blacklist == None %}
                                                    {{ package.blacklist|yesno:"active," }}
                                                {% else %}
                                                    {{ v.blacklist|yesno:"active," }}
                                                {% endif %} "
                                                data-toggle="button" data-version-id="{{ v.id }}"
                                                {% input_editability %}>
                                                {% if v.blacklist ==  None %}
                                                    {{ package.blacklist|yesno:_("Yes,No") }}
                                                {% else %}
                                                    {{ v.blacklist|yesno:_("Yes,No") }}
                                                {% endif %}
                                                </button>
                                            </td>
                                            <td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endif %}

                        {% if 'auth.write_access' in perms %}
                            <hr>

                            <div class="btn-toolbar" style="margin: 0;">
                                {% if add %}
                                    <div class="btn-group">
                                        <a class="btn btn-success" type="submit" id="savePackageButton">
                                            <i class="icon-ok icon-white"></i> {% trans "Save" %}</a>
                                    </div>
                                {% endif %}
                                {% if package.id %}
                                    <div class="btn-group">
                                        <a class="btn btn-danger" href="#delModal" data-toggle="modal">
                                            <i class="icon-remove icon-white"></i> {% trans "Delete" %}</a>
                                    </div>
                                {% endif %}
                            </div>
                        {% endif %}
                    </form>
                {% endif %}


                {% if package.pk %}
                    <div id="delModal" class="modal hide fade" tabindex="-1" role="dialog"
                         aria-labelledby="deleteModalLabel" aria-hidden="true">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h3 id="deleteModalLabel">Are you sure to delete this package?</h3>
                        </div>
                        <div class="modal-body">
                            <h4>Warning</h4>

                            <p>Are you sure to delete this package?</p>
                        </div>
                        <form method="POST" action="{% url 'packages:package_delete' package.pk %}" id="deleteform">
                            {% csrf_token %}
                        </form>
                        <div class="modal-footer">
                            <a class="btn" data-dismiss="modal">Cancel</a>
                            <a class="btn btn-danger" onclick="deleteform.submit()" href="#">Delete package</a>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}

{% block footer_js %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}js/packages.js"></script>
{% endblock %}
